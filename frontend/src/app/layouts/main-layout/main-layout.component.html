<mat-sidenav-container class="app-container">
  <!-- Sidenav (Men칰 Lateral) -->
  <mat-sidenav #sidenav mode="side" [opened]="menuAbierto()" class="app-sidenav">
    <!-- Logo o T칤tulo -->
    <div class="sidenav-header">
      <h2 class="app-title">Comercial Abi</h2>
    </div>

    <!-- Lista de Navegaci칩n -->
    <mat-nav-list>
      <h3 matSubheader>General</h3>
      <a
        mat-list-item
        routerLink="/app/pos"
        routerLinkActive="menu-item-active"
      >
        <mat-icon matListItemIcon>point_of_sale</mat-icon>
        <span matListItemTitle>Punto de Venta</span>
      </a>

      <!-- Nueva secci칩n de Productos para usuarios POS y User (NO Admin) -->
      <ng-container *ngIf="(canViewProducts$ | async) && !(isAdmin$ | async)">
        <a
          mat-list-item
          routerLink="/app/productos"
          routerLinkActive="menu-item-active"
        >
          <mat-icon matListItemIcon>inventory_2</mat-icon>
          <span matListItemTitle>Productos</span>
        </a>
      </ng-container>

      <!-- --- 游녢 INICIO DE LA MODIFICACI칍N (Agencia Virtual) --- -->
      <!-- Enlace externo a la SAT (Agencia Virtual) -->
      <!-- Se usa href y target="_blank" para abrir en pesta침a nueva -->
      <a
        mat-list-item
        href="https://farm3.sat.gob.gt/menu/login.jsf"
        target="_blank"
        rel="noopener noreferrer"
      >
        <!-- Nota: No hay un icono 'A'. Usamos 'account_balance' (banco/gobierno) por ser la SAT -->
        <mat-icon matListItemIcon>account_balance</mat-icon>
        <span matListItemTitle>Agencia Virtual</span>
      </a>
      <!-- --- 游녡 FIN DE LA MODIFICACI칍N --- -->

      <!-- --- 游녢 INICIO DE LA MODIFICACI칍N (Tarea 5.5) --- -->
      <!-- Este ng-container envuelve toda la secci칩n de Admin -->
      <!-- Se mostrar치 solo si isAdmin$ (del .ts) emite 'true' -->
      <ng-container *ngIf="isAdmin$ | async">
        <mat-divider></mat-divider>

        <!-- --- SECCI칍N DE ADMINISTRACI칍N MODIFICADA --- -->
        <a
          mat-list-item
          (click)="toggleMenuAdministracion()"
          class="menu-toggle-item"
        >
          <mat-icon matListItemIcon>shield_person</mat-icon>
          <span matListItemTitle>Administraci칩n</span>
          <span class="flex-spacer"></span>
          <mat-icon class="menu-toggle-icon">
            {{ menuAdministracionAbierto() ? 'expand_less' : 'expand_more' }}
          </mat-icon>
        </a>

        <!-- Submen칰 que se oculta y muestra -->
        @if (menuAdministracionAbierto()) {
        <div class="submenu">
          <a
            mat-list-item
            routerLink="/app/admin/productos"
            routerLinkActive="menu-item-active"
          >
            <mat-icon matListItemIcon>inventory_2</mat-icon>
            <span matListItemTitle>Productos</span>
          </a>
          <a
            mat-list-item
            routerLink="/app/admin/categorias"
            routerLinkActive="menu-item-active"
          >
            <mat-icon matListItemIcon>category</mat-icon>
            <span matListItemTitle>Categor칤as</span>
          </a>
          <a
            mat-list-item
            routerLink="/app/admin/proveedores"
            routerLinkActive="menu-item-active"
          >
            <mat-icon matListItemIcon>local_shipping</mat-icon>
            <span matListItemTitle>Proveedores</span>
          </a>

          <!-- === NUEVO ENLACE A칌ADIDO AQU칈 === -->
          <a
            mat-list-item
            routerLink="/app/admin/reporte-ventas"
            routerLinkActive="menu-item-active"
          >
            <mat-icon matListItemIcon>assessment</mat-icon>
            <span matListItemTitle>Reporte de Ventas</span>
          </a>

          <!-- --- 游녢 INICIO DE LA MODIFICACI칍N (Tarea 6.9) --- -->
          <a
            mat-list-item
            routerLink="/app/admin/usuarios"
            routerLinkActive="menu-item-active"
          >
            <mat-icon matListItemIcon>manage_accounts</mat-icon>
            <span matListItemTitle>Usuarios</span>
          </a>
          <!-- --- 游녡 FIN DE LA MODIFICACI칍N --- -->
        </div>
        }
        <!-- --- FIN DE SECCI칍N DE ADMINISTRACI칍N --- -->
      </ng-container>
      <!-- --- 游녡 FIN DE LA MODIFICACI칍N --- -->
    </mat-nav-list>
  </mat-sidenav>

  <!-- Contenido Principal -->
  <mat-sidenav-content class="app-content">
    <!-- Toolbar Superior -->
    <mat-toolbar color="primary" class="app-toolbar">
      <button mat-icon-button (click)="toggleMenu()">
        <mat-icon>menu</mat-icon>
      </button>
      <span>{{ title }}</span>
      <span class="toolbar-spacer"></span>

      <!-- Men칰 de Usuario -->
      @if (isAuthenticated$ | async) {
      <button mat-button [matMenuTriggerFor]="menuUsuario">
        <mat-icon>account_circle</mat-icon>
        <span class="username-display">{{
          (currentUser$ | async)?.email
        }}</span>
        <mat-icon>expand_more</mat-icon>
      </button>
      <mat-menu #menuUsuario="matMenu">
        <button mat-menu-item (click)="logout()">
          <mat-icon>logout</mat-icon>
          <span>Cerrar Sesi칩n</span>
        </button>
      </mat-menu>
      } @else {
      <a mat-button routerLink="/auth/login">
        <mat-icon>login</mat-icon>
        <span>Iniciar Sesi칩n</span>
      </a>
      }
    </mat-toolbar>

    <!--
      Aqu칤 es donde Angular cargar치 din치micamente el Punto de Venta,
      la lista de Productos, los Reportes, etc.
    -->
    <main class="main-content">
      <router-outlet />
    </main>
  </mat-sidenav-content>
</mat-sidenav-container>
