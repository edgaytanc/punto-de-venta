<mat-sidenav-container class="app-container">
  <!-- Sidenav (Menú Lateral) -->
  <mat-sidenav #sidenav mode="side" [opened]="menuAbierto()" class="app-sidenav">
    <!-- Logo o Título -->
    <div class="sidenav-header">
      <h2 class="app-title">MiPOS</h2>
    </div>

    <!-- Lista de Navegación -->
    <mat-nav-list>
      <h3 matSubheader>General</h3>
      <a
        mat-list-item
        routerLink="/app/pos"
        routerLinkActive="menu-item-active"
      >
        <mat-icon matListItemIcon>point_of_sale</mat-icon>
        <span matListItemTitle>Punto de Venta</span>
      </a>

      <mat-divider></mat-divider>

      <!-- --- SECCIÓN DE ADMINISTRACIÓN MODIFICADA --- -->
      <a
        mat-list-item
        (click)="toggleMenuAdministracion()"
        class="menu-toggle-item"
      >
        <mat-icon matListItemIcon>shield_person</mat-icon>
        <span matListItemTitle>Administración</span>
        <span class="flex-spacer"></span>
        <mat-icon class="menu-toggle-icon">
          {{ menuAdministracionAbierto() ? 'expand_less' : 'expand_more' }}
        </mat-icon>
      </a>

      <!-- Submenú que se oculta y muestra -->
      @if (menuAdministracionAbierto()) {
      <div class="submenu">
        <a
          mat-list-item
          routerLink="/app/admin/productos"
          routerLinkActive="menu-item-active"
        >
          <mat-icon matListItemIcon>inventory_2</mat-icon>
          <span matListItemTitle>Productos</span>
        </a>
        <a
          mat-list-item
          routerLink="/app/admin/categorias"
          routerLinkActive="menu-item-active"
        >
          <mat-icon matListItemIcon>category</mat-icon>
          <span matListItemTitle>Categorías</span>
        </a>
        <a
          mat-list-item
          routerLink="/app/admin/proveedores"
          routerLinkActive="menu-item-active"
        >
          <mat-icon matListItemIcon>local_shipping</mat-icon>
          <span matListItemTitle>Proveedores</span>
        </a>

        <!-- === NUEVO ENLACE AÑADIDO AQUÍ === -->
        <a
          mat-list-item
          routerLink="/app/admin/reporte-ventas"
          routerLinkActive="menu-item-active"
        >
          <mat-icon matListItemIcon>assessment</mat-icon>
          <span matListItemTitle>Reporte de Ventas</span>
        </a>
      </div>
      }
      <!-- --- FIN DE SECCIÓN DE ADMINISTRACIÓN --- -->
    </mat-nav-list>
  </mat-sidenav>

  <!-- Contenido Principal -->
  <mat-sidenav-content class="app-content">
    <!-- Toolbar Superior -->
    <mat-toolbar color="primary" class="app-toolbar">
      <button mat-icon-button (click)="toggleMenu()">
        <mat-icon>menu</mat-icon>
      </button>
      <span>{{ title }}</span>
      <span class="toolbar-spacer"></span>

      <!-- Menú de Usuario -->
      @if (isAuthenticated$ | async) {
      <button mat-button [matMenuTriggerFor]="menuUsuario">
        <mat-icon>account_circle</mat-icon>
        <span class="username-display">{{
          (currentUser$ | async)?.email
        }}</span>
        <mat-icon>expand_more</mat-icon>
      </button>
      <mat-menu #menuUsuario="matMenu">
        <button mat-menu-item (click)="logout()">
          <mat-icon>logout</mat-icon>
          <span>Cerrar Sesión</span>
        </button>
      </mat-menu>
      } @else {
      <a mat-button routerLink="/auth/login">
        <mat-icon>login</mat-icon>
        <span>Iniciar Sesión</span>
      </a>
      }
    </mat-toolbar>

    <!--
      Aquí es donde Angular cargará dinámicamente el Punto de Venta,
      la lista de Productos, los Reportes, etc.
    -->
    <main class="main-content">
      <router-outlet />
    </main>
  </mat-sidenav-content>
</mat-sidenav-container>
